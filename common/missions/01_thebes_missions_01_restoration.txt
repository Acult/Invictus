thebes_missions_01_restoration = {
    header = "mission_image_generic_greek"
    icon = "egypt_3"

    repeatable = no

    chance = {}

    potential = { 
    	tag = THE
    	NOT = { has_variable = thebes_mission_cooldown }
    }

    abort = {}

    on_potential = {}

    on_start = {

    }

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = thebes_mission_cooldown
            days = 7300
        }
    }
    on_completion = {
        add_country_modifier = {
            name = boeotian_power 
            duration = -1 
        }
    }

    thebes_missions_01_restoration_task_1 = {	#Taking the first steps
        icon = "task_political"

        highlight = {
        	scope:province = {
        		this = p:426
        	}
        }
        allow = {
        	p:426 = {
        		num_of_used_building_slots >= 2
        		trigger_if = {
        			limit = { has_construction = yes }
        			custom_tooltip = {
        				text = province_has_no_constuction_tooltip
        				has_construction  = no
        			}
        		}
        	}
        }

        on_completion = {
        	show_as_tooltip = {
	        	add_country_modifier = {
	        		name = building_spree
	        		duration = 1095
	        	}
        	}
        	trigger_event = me_thebes.1
        }
    }

    thebes_missions_01_restoration_task_2 = {	#Breaking out of Boetia
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_1 }
        potential = {}

        allow = {
        	treasury >= 15
        }

        on_completion = { 
        	add_treasury = -15
        	p:468 = {
        		add_claim = ROOT
        	}
        	show_as_tooltip = {
        		add_country_modifier = {
        			name = boetian_preparations
        			duration = 730
        		}
        	}
        	trigger_event = me_thebes.2
        }
    }

    thebes_missions_01_restoration_task_3 = { #Protecting the city
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_1 }

        highlight = {
        	scope:province = {
        		this = p:426
        	}
        }

        allow = {
        	p:426 = {
        		num_of_fortress_building >= 2
        		trigger_if = {
        			limit = { has_construction = yes }
        			custom_tooltip = {
        				text = province_has_no_constuction_tooltip
        				has_construction  = no
        			}
        		}        		
        	}
        }

        on_completion = {
        	trigger_event = me_thebes.3
        	add_2_free_province_investments = yes
        	p:426 = {
                add_permanent_province_modifier = {
                    name = fortifications_of_thebes
            	}
            }
        }
    }

    thebes_missions_01_restoration_task_4 = {	#Preparing for the War
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_2 }
        duration = 180

        allow = {
        	war = no
        	trigger_if = {
        		limit = { is_ai = no }
	        	custom_tooltip = {
	        		text = thebes_missions_01_restoration_task_4_tooltip
		        	any_character = {
		        		is_mercenary = yes
		        	}
	        	}
        	}
        }

        on_start = {
        #Event to give some good stuff to the mercenary character and maybe increase your rulers martial
        	custom_tooltip = thebes_missions_01_restoration_task_4_A_tooltip
        	trigger_event = me_thebes.4
        }
        on_completion = {
        	trigger_event = me_thebes.5
        }
    }

    thebes_missions_01_restoration_task_5 = {	#The Struggle for Boetia
        icon = "task_political"
		requires = { thebes_missions_01_restoration_task_4 }

		highlight = {
			scope:province = {
				owner = c:BOE
			}
		}

        allow = {
        	war_with = c:BOE
        }

        on_completion = {
        	trigger_event = me_thebes.6
        	add_country_modifier = {
        		name = boetian_struggle
        		duration = 730
        	}
        }
    }

    thebes_missions_01_restoration_task_6 = {	#Theban Thespiai
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_5 }
        highlight = {
        	scope:province = {
        		province_id = 468
        	}
        }

        allow = {	#Own boetian capital
        	owns = 468
            p:468 = {
                num_of_used_building_slots >= 3
                trigger_if = {
                    limit = { has_construction = yes }
                    custom_tooltip = {
                        text = province_has_no_constuction_tooltip
                        has_construction  = no
                    }
                }
            }
        }

        on_completion = {
        	trigger_event = me_thebes.7
        	p:468 = {
        		add_province_modifier = {
        			name = theban_influence 
        			duration = 3650
        		}
        		capital_formable_small_effect = yes
        	}
        }
    }

    thebes_missions_01_restoration_task_7 = { #Theban Traders
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_1 }
        highlight = {
        	scope:province = {
        		this = p:426
        	}
        }
        allow = {
        	p:426 = {
        		num_of_commerce_building >= 1
        		num_of_town_hall_building >= 1
        	}
        }

        on_completion = {
        	add_treasury = 100
        	current_ruler = {
        		add_popularity = 10
        	}
        	capital_scope = {
        		capital_formable_small_effect = yes
        	}
        }
    }
    thebes_missions_01_restoration_task_8 = {
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_7 thebes_missions_01_restoration_task_3 }
        highlight = {
        	scope:province = {
        		this = p:426
        	}
        }
        allow = {
        	p:426 = {
        		num_of_used_building_slots >= 6
        		total_population >= 25
        		trigger_if = {
        			limit = { has_construction = yes }
        			custom_tooltip = {
        				text = province_has_no_constuction_tooltip
        				has_construction  = no
        			}
        		}        		
        	}
        }

        on_completion = {
        	p:426 = {
	        	add_permanent_province_modifier = {
	        		name = city_of_thebes
	        		mode = add
	        	}
        	}
        }
    }
    thebes_missions_01_restoration_task_9 = {	#
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_5 }
        highlight = {
        	scope:province = {
        		is_in_area = boeotia_area
        	}
        }

        allow = { #Own at least 5 province in the boetia area
        	custom_tooltip = {
        		text = thebes_missions_01_restoration_task_9_tooltip
	        	any_owned_province = {
	        		count >= 5
	        		is_in_area = boeotia_area
	        	}
        	}
        }

        on_completion = {
        	custom_tooltip = thebes_missions_01_restoration_task_9_B_tooltip
        	hidden_effect = {
	        	area:boeotia_area = {
	        		formable_area_province_effect = yes
	        	}
        	}
        }
    }
    thebes_missions_01_restoration_task_10 = {	#Resurgance of Thebes
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_9 }
        final = yes
        highlight = {
        	scope:province = {
        		is_in_area = boeotia_area
        	}
        }


        allow = {
        	owns_or_subject_owns_area = boeotia_area
        }

        on_completion = {
            current_ruler = {
                add_popularity = 10
            }
        }
    }
    thebes_missions_01_restoration_task_11 = {	#The Great city of Delphi
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_5 }
        highlight = {
        	scope:province = {
        		this = p:424
        	}
        }

        allow = {
        	p:424 = {
        		owner = root
        		num_of_court_building >= 1
        		num_of_academy_building >= 1
        		trigger_if = {
        			limit = { has_construction = yes }
        			custom_tooltip = {
        				text = province_has_no_constuction_tooltip
        				has_construction  = no
        			}
        		}        		
        	}
        }

        on_completion = {
        	add_treasury = 100
        	p:424 = {
        		add_province_modifier = {
        			name = theban_influence
        			duration = 3650
        		}
        	}
        	#Trigger event to go see the oracle or reject.
        }
    }
    thebes_missions_01_restoration_task_12 = {	#The Sacred Band of Thebes
        icon = "task_political"

        allow = {
        	custom_tooltip = {
        		text = thebes_missions_01_restoration_task_12_tooltip
		        any_country_sub_unit = {
		        	count >= 10
		        	is_cohort = yes
		        }
	        }
        }

        on_completion = {
        	add_military_experience = 20
        	add_country_modifier = {
        		name = theban_sacred_band
        		duration = -1
        	}
        }
    }
    thebes_missions_01_restoration_task_13 = {	#Seven-Gated Thebes
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_8 }
        highlight = {
        	scope:province = {
        		this = p:426
        	}
        }
        allow = {
        	p:426 = {
        		total_population >= 35
        		state = {
        			calc_true_if = {
        				amount >= 2
	                    state_improvement_military_trigger = yes
	                    state_improvement_civic_trigger = yes
	                    state_improvement_oratory_trigger = yes
	                    state_improvement_religious_trigger = yes        				
        			}
        		}       		
        	}
        }

        on_completion = {
        	add_2_free_province_investments = yes
        	p:426 = {
        		add_permanent_province_modifier = {
        			name = city_of_thebes 
        			mode = add
        		}
        	}
        }
    }
    thebes_missions_01_restoration_task_14 = {	#A Reliable source of Food
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_2 }

        highlight = {
        	scope:province = {
        		this = p:7798
        	}
        }
        allow = {
        	p:7798 = {
        		num_of_basic_settlement_infratructure_building >= 1
        	}
        }

        on_completion = {
        	if = {
        		limit = {
        			p:406 = { has_city_status = no }
        		}
        		p:406 = { 
        			set_trade_goods = grain 
        			add_permanent_province_modifier = {
        				name = theban_food_source
        				duration = -1
        			}
        		}
        	}
        	p:7798 = {
        		add_permanent_province_modifier = {
        			name = theban_food_source
        			duration = -1
       			}        		
        	}
        }
    }
    thebes_missions_01_restoration_task_15 = {   #Destroying Orchomenos
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_5 }
        prevented_by = { thebes_missions_01_restoration_task_16 }
        bypass = { has_completed_mission_task = thebes_missions_01_restoration_task_16 }

        highlight = {
            scope:province = {
                this = p:423
            }
        }
        allow = {
            owns = 423
        }

        on_completion = {
            #Trigger Event
            add_treasury = 200
            current_ruler = {
                add_popularity = 10
            }
            add_legitimacy = 10
            p:423 = {
                add_province_modifier = {
                    name = devestation
                    duration = 1095
                }
                while = {
                    count = orchomenos_pops_minus_one_svalue
                    random_pops_in_province = { kill_pop = yes }
                }
            }
        }
    }
    thebes_missions_01_restoration_task_16 = {   #Coooperating with Orchomenos
        icon = "task_political"
        requires = { thebes_missions_01_restoration_task_5 }
        prevented_by = { thebes_missions_01_restoration_task_15 }
        bypass = { has_completed_mission_task = thebes_missions_01_restoration_task_15 }

        highlight = {
            scope:province = {
                this = p:423
            }
        }
        allow = {
            owns = 423
            p:423 = {
                has_city_status = yes
            }
        }

        on_completion = {
            p:423 = {
                add_province_modifier = {
                    name = theban_support
                    duration = -1
                }
            }
        }
    }
}