fezzani_mission_01 = {
    header = "mission_image_general" # SPECIAL FIELD - Sets top picture for the mission
    icon = "general_1" # SPECIAL FIELD - Sets icon for the mission

    repeatable = no # SPECIAL FIELD - Sets if a mission can be done once or several times

    chance = {
        factor = 50000
        } # SPECIAL FIELD - Sets the chances of a mission appearing in your list of available missions

    potential = {
        NOT = { has_variable = fezzani_mission_cooldown }
        OR = {
            tag = MKA # MAKAE
            tag = PSY # PSYLLI
            tag = NAS # NASAMONES
            tag = GAR # GARAMANTES
            tag = MHY # MACHYLES
            tag = PHZ # PHAZANI
        } # TRIGGER FIELD - Sets the conditions for the mission to appear in your list
    }
    on_start = {
        save_scope_as = me_fezzani_scope
        start_mission_ai_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is started

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_completion = {
        complete_mission_effect = yes
        add_country_modifier = {
            name = desert_rose
        }
    } # EFFECT FIELD - These effects are run when the mission is completed





    ########################################
    # Generic - for all tags
    ########################################

    fezzani_mission_01_task_01 = { # task 1 - The fezzan Crown - tribe to monarchy common to all
        icon = "task_political"

        allow = {
            stability >= 55
            centralization > 95

            trigger_if = {
                limit = { 
                    tag = PSY 
                }
                is_subject = no
            }
        }

        bypass = { is_monarchy = yes }

        on_completion = {
            trigger_event = { id = me_fezzani.1 }      

            show_as_tooltip = {
                add_country_modifier = {
                    name = king_of_fezzan
                }
                current_ruler = {
                    add_popularity = 20
                    add_trait = confident
                }
            }
            
            
            ###     The following was taken directly from the tribal reform mission
            change_government = despotic_monarchy       
            switch_government_type_event_clearup_effect = yes
            if = {
                limit = {
                    exists = scope:monarchy_family
                    scope:monarchy_family = {
                        any_family_member = {
                            is_adult = yes
                            trigger_if = {
                                limit = {
                                    root = {
                                        gender_equality = no
                                    }
                                }
                                is_male = yes
                            }
                            has_any_office = no
                        }
                    }
                }
                custom_tooltip = grant_offices_monarchy_reform_tt
                hidden_effect = {
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_foreign_minister
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = charisma
                                        }
                                    }
                                }
                                give_office = office_foreign_minister
                            }
                        }
                    }
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_marshal
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = martial
                                        }
                                    }
                                }
                                give_office = office_marshal
                            }
                        }
                    }
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_high_priest_monarchy
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = zeal
                                        }
                                    }
                                }
                                give_office = office_high_priest_monarchy
                            }
                        }
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_02 = { # task 2 - the people of fezzan common to all
        icon = "task_expansion"
        requires = {  }

        allow = {
            political_influence >= 50
        }

        on_completion = {
            trigger_event = { id = me_fezzani.2 }

            show_as_tooltip = {
                add_political_influence = -50
                add_2_free_province_investments = yes
                add_innovation = 1
                add_country_modifier = {
                    name = people_of_fezzan
                }
            }

        }
    }

    fezzani_mission_01_task_16 = { # the mines of Phazania
        icon = "task_political"
        requires = { 
            fezzani_mission_01_task_13 
            fezzani_mission_01_task_109
        }

        allow = {
            owns = 8238
            hidden:p:8238 = {
                has_building = slave_mine_building
            }
            owns = 8229
            hidden:p:8229 = {
                has_building = slave_mine_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8238
                    province_id = 8229
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.16 }
            # event chain possibly to move the capital to the old nasamonian capitsl
            
            show_as_tooltip = {
                p:8238 = {
                    add_permanent_province_modifier = {
                        name = mines_phazania
                    }
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
                p:8229 = {
                    add_permanent_province_modifier = {
                        name = mines_phazania
                    }
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
            }
        }
    }

    fezzani_mission_01_task_19 = { # encountering the greeks - colonize near nasamonia
        icon = "task_political"
        requires = { 
            fezzani_mission_01_task_08 # garamantes
            fezzani_mission_01_task_110 # Psyllia
        }

        allow = {
            owns = 8129
            owns = 8132
            owns = 8133
            trigger_if = {
                limit = { is_ai = no }
                owns = 8134
                hidden:p:8134 = {
                    free_building_slots = 0
                }
                owns = 8130
                hidden:p:8130 = {
                    free_building_slots = 0
                }
            }
            trigger_if = { # AI Handholding
                limit = { is_ai = yes }
                p:8134 = {
                    is_uninhabitable = no
                    has_owner = no
                }
                p:8130 = {
                    is_uninhabitable = no
                    has_owner = no
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8134
                    province_id = 8130
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.19 }
            # event chain about meeting the greek ownwers of 3340
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_19_tt
            }
        }
    }

    fezzani_mission_01_task_21 = { # the makean gold
        icon = "task_conquest"
        requires = { 
            fezzani_mission_01_task_17 # garamantes
            fezzani_mission_01_task_102 fezzani_mission_01_task_103 # psyllia
        }
        allow = {
            owns = 8222
            hidden:p:8222 = {
                has_building = slave_mine_building
            }
            owns = 8209
            hidden:p:8209 = {
                has_building = slave_mine_building
            }
        }

        bypass = {
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8209
                    province_id = 8222
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.36 }

            show_as_tooltip = {
                p:8222 = {
                    add_permanent_province_modifier = {
                        name = makean_gold
                    }
                }
                p:8209 = {
                    add_permanent_province_modifier = {
                        name = makean_gold
                    }
                }
            }
        }
    }


    ########################################
    # Garamantes Specific 3 - 100
    ########################################

    fezzani_mission_01_task_03 = { # The kingdom of Garamantes
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = {  }
        allow = {
            trigger_if = {
                limit = { is_ai = no }

                treasury >= 75
                stability >= 55
            }
            trigger_if = {
                limit = { is_ai = yes }
                
                treasury >= 75
                stability >= 40
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.3 }

            show_as_tooltip = {
                add_treasury = -75
                add_military_experience = 10
                add_centralization = 20
                current_ruler = {
                    add_trait = ambitious
                    add_martial = 3
                }
                add_country_modifier = {
                    name = kingdom_of_garamantes
                }
            }
        }
    }

    fezzani_mission_01_task_04 = { # The Machylia
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_03 }
        allow = {
            political_influence >= 25
        }

        bypass = { # bypass if they are a subject of us already somehow or do not exist
            OR = {
                c:MHY = {
                    has_land = no
                }
                c:MHY = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8142
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.4 }
            # event chain to try to provoke them into declaring war

            show_as_tooltip = {
                add_political_influence = -25
                p:8142 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_05 = { # The desert capital
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            trigger_if = {
                limit = { is_ai = no }
                p:8168 = {
                    has_construction = no
                    free_building_slots = 0
                    hidden:p:8168.state = {
                        calc_true_if = {
                            amount >= 3
                            state_improvement_civic_trigger = yes
                            state_improvement_oratory_trigger = yes
                            state_improvement_religious_trigger = yes
                        }
                    }
                }
            }
            trigger_if = { # AI Handholding
                limit = { is_ai = yes }
                p:8168 = {
                    has_construction = no
                    free_building_slots = 0
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8168
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.5 }

            show_as_tooltip = {
                p:8168 = { 
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                add_centralization = 20
            }
        }
    }

    fezzani_mission_01_task_06 = { # The desert breadbasket
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            p:8164 = { # grain
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8175 = { # grain
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8166 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8156 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8181 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8182 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8164
                    province_id = 8175
                    province_id = 8166
                    province_id = 8156
                    province_id = 8181
                    province_id = 8182
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.6 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = desert_breadbasket
                }
                add_centralization = 15
            }
        }
    }

    fezzani_mission_01_task_07 = { # Strategic Planning
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_03 }
        allow = {
            treasury >= 100
            p:8149 = {
                free_building_slots >=1
            }
        }

        duration = 365

        highlight = {
            scope:province = {
                province_id = 8149
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.7 }

            show_as_tooltip = {
                add_military_experience = 25
                add_2_free_province_investments = yes
                add_country_modifier = {
                    name = strategic_planning
                }
                p:8149 = {
                    add_building_level = fortress_building
                }
            }
        }
    }

    fezzani_mission_01_task_08 = { # the nasamonians
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_04 }
        allow = {
            owns_or_subject_owns = 8142
        }

        bypass = {
            OR = {
                c:NAS = {
                    has_land = no
                }
                c:NAS = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8128
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.8 }

            show_as_tooltip = {
                p:8128 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_09 = { # the city of waddan
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_05 }
        allow = {
            owns = 8142
            hidden:p:8142 = {
                has_construction = no
                has_city_status = yes
                has_building = forum_building
                has_building = military_building
                has_building = commerce_building
                has_building = population_building
            }
        }

        highlight = {
            scope:province = {
                province_id = 8142
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.8 }

            show_as_tooltip = {
                add_centralization = 10

                p:8142 = {
                    add_permanent_province_modifier = {
                        name = waddan_glory
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_10 = { # The date trade
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_06 }

        allow = { 
            treasury >= 150
            #At least 3 dates are being produced in the Fezzan region
            custom_tooltip = {
                text = fezzan_dates_produced_task24_tooltip
                fezzan_dates_produced_task24_current >= fezzan_dates_produced_task24_total
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.10 }
            show_as_tooltip = {
                add_country_modifier = {
                    name = fezzani_the_perfect_date
                }
                p:8168 = {
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
                add_innovation = 2
            }
        }
    }

    fezzani_mission_01_task_11 = { # The Makae
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_04 }

        allow = {
            owns_or_subject_owns = 8142
        }

        bypass = {
            OR = {
                c:MKA = {
                    has_land = no
                }
                c:MKA = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8218
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.11 }
            
            show_as_tooltip = {
                p:8218 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_12 = { # subjects of the garamantes
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_07 }

        allow = {
            political_influence >= 200
            stability >= 60
            custom_tooltip = {
                text = fezzani_mission_01_task_12_tt
                any_subject = {
                    count >= 1
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.12 }
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_12_tt_a
                add_political_influence = -200
                add_country_modifier = {
                    name = garamantes_march
                }
                every_subject = {
                    add_country_modifier = {
                        name = subject_military_contribution
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_13 = { # the phazania
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_07 }

        allow = {
            trigger_if = {
                limit = { is_ai = no }
                p:8154 = {
                    has_city_status = yes
                    has_building = fortress_building
                    num_of_military_building >= 3
                }
                owns = 8214
                treasury >= 50
            }
            trigger_if = { # AI Handholding
                limit = { is_ai = yes }
                owns = 8214
            }
        }

        bypass = {
            OR = {
                c:PHZ = {
                    has_land = no
                }
                c:PHZ = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8233
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.13 }
            # event chain
            
            show_as_tooltip = {
                add_treasury = -50
                p:8233 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_14 = { # psyllia
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_08 fezzani_mission_01_task_11 }

        allow = {
            OR = {
                owns_or_subject_owns = 8137
                owns_or_subject_owns = 8197
            }
        }

        bypass = {
            OR = {
                c:PSY = {
                    has_land = no
                }
                c:PSY = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 3333
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.14 }
            # event chain
            
            show_as_tooltip = {

                custom_tooltip = me_fezzani_14.a.tt
        
                add_treasury = -50
            }
        }
    }

    fezzani_mission_01_task_15 = { # an eastern capital prep to colonize
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_09 }

        allow = {
            owns = 8128
            hidden:p:8128 = {
                num_of_used_building_slots >= 7
                num_of_fortress_building >= 2
                has_building = forum_building
                has_building = library_building
                has_building = population_building
            }
        }

        highlight = {
            scope:province = {
                province_id = 8128
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.15 }
            
            show_as_tooltip = {
                add_innovation = 4
                p:8128 = {
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
            }
        }
    }

    fezzani_mission_01_task_17 = { # the land of the makae
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_11 }

        allow = {
            owns = 8220
            hidden:p:8220 = {
                has_building = slave_mine_building
            }
            owns = 8222
            hidden:p:8222 = {
                has_building = slave_mine_building
            }
            owns = 8217
            hidden:p:8217 = {
                has_building = slave_mine_building
            }
            owns = 8226
            hidden:p:8226 = {
                has_building = basic_settlement_infratructure_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8220
                    province_id = 8222
                    province_id = 8217
                    province_id = 8226
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.17 }
            # check if BASE has_owner , if not colonize it for money
            
            show_as_tooltip = {
                add_4_free_province_investments = yes
                p:8218 = {
                    add_permanent_province_modifier = {
                        name = makaean_infrastructure
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_18 = { # the ports of Psyllia
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_10 }

        allow = {
            owns = 3333
            hidden:p:3333 = {
                has_city_status = yes
                has_construction = no
                num_of_port_building >= 4
            }
            custom_tooltip = {
                text = fezzani_mission_01_task_18_tt
                any_navy = {
                    any_sub_unit = {
                        count >= 15
                    }
                    has_commander = yes
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3333
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.18 }
            # check if BASE has_owner , if not colonize it for money
            
            show_as_tooltip = {
                add_country_modifier = {
                    name = ports_of_psyllia
                }
            }
        }
    }

    # Task 19 is common 

    # Task 20 is the unification one

    # Task 21 is common

    ########################################
    # Psyllia Specific 101 - 200
    ########################################

    fezzani_mission_01_task_101 = { # The Nasamonian Overlords
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = {  }
        allow = {
            treasury >= 50
        }

        bypass = {
            c:PSY = {
                is_subject = no
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.101 }

            show_as_tooltip = {
                # Send the nasamonians money in exchange for pops to help with future missions colonizing
                # nasamonia will "spread" word among their people that there is land available in the psyllian lands
                # add migration growth and pop promotion
                custom_tooltip = fezzani_mission_01_task_101_tt
            }
        }
    }

    fezzani_mission_01_task_102 = { # The Capital Port
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            p:3333 = {
                has_city_status = yes
                num_of_port_building >= 3
            }
        }

        highlight = {
            scope:province = {
                province_id = 3333
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.102 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = psyllia_capital_port
                }
                create_unit = {
                    navy = yes
                    #add_subunit = mega_galley
                    add_subunit = octere
                    add_subunit = trireme
                    add_subunit = trireme
                    add_subunit = trireme
                }
            }
        }
    }

    fezzani_mission_01_task_103 = { # The coast
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            hidden:p:3337 = {
                has_building = port_building
            }
            hidden:p:3335 = {
                has_building = port_building
            }
            hidden:p:3336 = {
                has_building = basic_settlement_infratructure_building
            }
            hidden:p:3334 = {
                has_building = latifundia_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3335
                    province_id = 3336
                    province_id = 3334
                    province_id = 3337
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.103 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = psyllian_coast
                }
            }
        }
    }

    fezzani_mission_01_task_104 = { # Mediterranean Exploration
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_21 }
        allow = {
            custom_tooltip = {
                text = fezzani_mission_01_task_104_tt
                any_navy = {
                    any_sub_unit = {
                        count >= 20
                    }
                    has_commander = yes
                }
            }
        }

        highlight = {
        }

        duration = 365

        on_start = {
            custom_tooltip = fezzani_mission_01_task_104_tt.a
            trigger_event = { id = me_fezzani.104 }
        }

        on_completion = { 

            show_as_tooltip = {
            }
        }
    }

    fezzani_mission_01_task_105 = { # Colonize to the right
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_101 }
        allow = {
            hidden:p:3337 = {
                has_building = port_building
            }
        }

        bypass = {
            p:3338 = {
                has_owner = yes
            }
        }

        highlight = {
            scope:province = {
                province_id = 3338
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.105 }

            show_as_tooltip = {
                p:3338 = {
                    set_owned_by = root
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
            }
        }
    }

    fezzani_mission_01_task_106 = { # Colonize to the left
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_101 }
        allow = {
            p:3333 = {
                free_building_slots = 0
            }
            p:3332 = {
                free_building_slots = 0
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
        }

        bypass = {
            p:3330 = {
                has_owner = yes
            }
        }

        highlight = {
            scope:province = {
                province_id = 3330
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.106 }

            show_as_tooltip = {
                p:3330 = {
                    set_owned_by = root
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
            }
        }
    }

    fezzani_mission_01_task_107 = { # cold war
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_106 }
        allow = {
            owns = 3330
        }

        bypass = {
            c:MKA = {
                has_land = no
            }
        }

        duration = 365

        highlight = {
            scope:province = {
                province_id = 3330
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.107 }

            custom_tooltip = fezzani_mission_01_task_107_tt

            show_as_tooltip = {

                c:PSY = {
                    declare_war_with_wargoal = {
                        war_goal = conquer_wargoal 
                        province = c:MKA.capital_scope
                        target = MKA
                    }
                }
                # add as an event after the war starts
                # make the event like in the lotr return of the king when
                # theoden's riders ride in
                # make it such that if nasamonia has no land then the
                # garamantes will help out
                add_to_war = {
                    target = c:NAS
                    leader = no
                    attacker = yes
                }
            }
        }
    }

    fezzani_mission_01_task_108 = { # the spoils of war - colonizing more
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_107 }
        allow = {
            owns_area = psyllia_area
            owns_area = zamzam_area
            owns_area = soffegin_area
        }

        bypass = {
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3326
                    province_id = 3327
                    province_id = 3329
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.108 }
            # freeing some of the slaves that were held under the makae and using them to
            # help us colonize

            show_as_tooltip = {
                add_military_experience = 25
                p:3326 = {
                    set_owned_by = root
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                p:3327 = {
                    set_owned_by = root
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                p:3329 = {
                    set_owned_by = root
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                
                area:syrtis_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_109 = { # phazania
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_107 }
        allow = {
            owns_area = girgiri_area
        }

        bypass = {
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = phazania_area
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.109 }

            show_as_tooltip = {
                add_4_free_province_investments = yes
                area:phazania_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_110 = { # the nasamonians
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_107 fezzani_mission_01_task_114 }
        allow = {
            owns = 8142
            owns_area = psyllia_area
            c:MHY = {
                has_land = no
            }
        }

        bypass = {
            c:NAS = {
                has_land = no
            }
        }

        highlight = {
            scope:province = {
                province_id = 8142
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.110 }
            # event chain depending if we are still a tributary
            # if we are still a tributary, demoralize the nasamonians to see
            # their subject eclipse them
            # otherwise just declare war

            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_110_tt
            }
        }
    }

    fezzani_mission_01_task_111 = { # the garamantes
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_110 fezzani_mission_01_task_108 }
        allow = {
            owns_area = area:syrtis_area
            owns_area = area:nasamonia_area
        }

        bypass = {
            c:GAR = {
                has_land = no # just in case
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = syrtis_area
                    is_in_area = nasamonia_area
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.111 }

            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_111_tt
                hidden_effect = { 
                    c:GAR = { 
                        every_owned_province = { 
                            add_claim = root 
                        } 
                    } 
                }
            }
        }
    }

    # 112 is the same as 21 which is the makean gold task

    fezzani_mission_01_task_113 = { # The Expedition
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_104 }
        allow = {
            custom_tooltip = {
                text = fezzani_mission_01_task_113_tt
                owns = 1471
                owns = 471
            }
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.113 }

            show_as_tooltip = {
            }
        }
    }

    fezzani_mission_01_task_114 = { # fortifying the east
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_105 }
        allow = {
            owns = 3339
            hidden:p:3339 = {
                has_building = fortress_building
            }
        }

        highlight = {
            scope:province = {
                province_id = 3339
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.114 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = psyllia_defense
                }
            }
        }
    }




    ################################################################################
    # Final Formation of fezzan - common to all
    ################################################################################
    fezzani_mission_01_task_20 = { # a desert Rose
        icon = "task_political"
        potential = {
            OR = {
                tag = GAR
                tag = PSY
            }
        }

        requires = { 
            fezzani_mission_01_task_14 fezzani_mission_01_task_19 # Garamantes
            fezzani_mission_01_task_111 # Psyllia
        }

        final = yes

        allow = {
            owns_region = fezzan_region
        }

        highlight = {
            scope:province = {
                is_in_region = fezzan_region
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.20 }
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_20_tt
            }
        }
    }






} # last