fezzani_mission_01 = {
    header = "mission_image_general" # SPECIAL FIELD - Sets top picture for the mission
    icon = "general_1" # SPECIAL FIELD - Sets icon for the mission

    repeatable = no # SPECIAL FIELD - Sets if a mission can be done once or several times

    chance = {
        factor = 50000
        } # SPECIAL FIELD - Sets the chances of a mission appearing in your list of available missions

    potential = {
        NOT = { has_variable = fezzani_mission_cooldown }
        OR = {
            tag = MKA # MAKAE
            tag = PSY # PSYLLI
            tag = NAS # NASAMONES
            tag = GAR # GARAMANTES
            tag = MHY # MACHYLES
            tag = PHZ # PHAZANI
        } # TRIGGER FIELD - Sets the conditions for the mission to appear in your list
        is_subject = no # must not be a subject
    }
    on_start = {
        save_scope_as = me_fezzani_scope
        start_mission_ai_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is started

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_completion = {
        complete_mission_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is completed





    fezzani_mission_01_task_01 = { # task 1 - The fezzan Crown - tribe to monarchy common to all
        icon = "task_political"

        allow = {
            stability >= 55
            centralization > 95
        }

        bypass = { is_monarchy = yes }

        on_completion = {
            trigger_event = { id = me_fezzani.1 }      

            show_as_tooltip = {
                add_country_modifier = {
                    name = king_of_fezzan
                }
                current_ruler = {
                    add_popularity = 20
                    add_trait = confident
                }
            }
            
            
            ###     The following was taken directly from the tribal reform mission
            change_government = despotic_monarchy       
            switch_government_type_event_clearup_effect = yes
            if = {
                limit = {
                    exists = scope:monarchy_family
                    scope:monarchy_family = {
                        any_family_member = {
                            is_adult = yes
                            trigger_if = {
                                limit = {
                                    root = {
                                        gender_equality = no
                                    }
                                }
                                is_male = yes
                            }
                            has_any_office = no
                        }
                    }
                }
                custom_tooltip = grant_offices_monarchy_reform_tt
                hidden_effect = {
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_foreign_minister
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = charisma
                                        }
                                    }
                                }
                                give_office = office_foreign_minister
                            }
                        }
                    }
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_marshal
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = martial
                                        }
                                    }
                                }
                                give_office = office_marshal
                            }
                        }
                    }
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_high_priest_monarchy
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = zeal
                                        }
                                    }
                                }
                                give_office = office_high_priest_monarchy
                            }
                        }
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_02 = { # task 2 - the people of fezzan common to all
        icon = "task_expansion"
        requires = {  }

        allow = {
            political_influence >= 50
        }

        on_completion = {
            trigger_event = { id = me_fezzani.2 }

            show_as_tooltip = {
                add_political_influence = -50
                add_2_free_province_investments = yes
                add_innovation = 1
                add_country_modifier = {
                    name = people_of_fezzan
                }
            }

        }
    }


    ########################################
    # Garamantes Specific 3 - 100
    ########################################

    fezzani_mission_01_task_03 = { # The kingdom of Garamantes
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = {  }
        allow = {
            treasury >= 75
            stability > 55
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.3 }

            show_as_tooltip = {
                add_treasury = -75
                add_military_experience = 10
                add_centralization = 20
                current_ruler = {
                    add_trait = ambitious
                    add_martial = 3
                }
                add_country_modifier = {
                    name = kingdom_of_garamantes
                }
            }
        }
    }

    fezzani_mission_01_task_04 = { # The Machylia
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_03 }
        allow = {
            political_influence >= 25
        }

        bypass = { # bypass if they are a subject of us already somehow or do not exist
            OR = {
                c:MHY = {
                    has_land = no
                }
                c:MHY = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8142
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.4 }
            # event chain to try to provoke them into declaring war

            show_as_tooltip = {
                add_political_influence = -25
                p:8142 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_05 = { # The desert capital
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            p:8168 = {
                has_construction = no
                free_building_slots = 0
                hidden:p:8168.state = {
                    calc_true_if = {
                        amount >= 3
                        state_improvement_civic_trigger = yes
                        state_improvement_oratory_trigger = yes
                        state_improvement_religious_trigger = yes
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8168
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.5 }

            show_as_tooltip = {
                p:8168 = { 
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                add_centralization = 20
            }
        }
    }

    fezzani_mission_01_task_06 = { # The desert breadbasket
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            p:8164 = { # grain
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8175 = { # grain
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8166 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8156 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8181 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            p:8182 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8164
                    province_id = 8175
                    province_id = 8166
                    province_id = 8156
                    province_id = 8181
                    province_id = 8182
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.6 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = desert_breadbasket
                }
                add_centralization = 15
            }
        }
    }

    fezzani_mission_01_task_07 = { # Strategic Planning
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_03 }
        allow = {
            treasury >= 100
            p:8149 = {
                free_building_slots >=1
            }
        }

        duration = 365

        highlight = {
            scope:province = {
                province_id = 8149
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.7 }

            show_as_tooltip = {
                add_military_experience = 25
                add_2_free_province_investments = yes
                add_country_modifier = {
                    name = strategic_planning
                }
                p:8149 = {
                    add_building_level = fortress_building
                }
            }
        }
    }

    fezzani_mission_01_task_08 = { # the nasamonians
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_04 }
        allow = {
            owns_or_subject_owns = 8142
        }

        bypass = {
            OR = {
                c:NAS = {
                    has_land = no
                }
                c:NAS = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8128
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.8 }

            show_as_tooltip = {
                p:8128 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_09 = { # the city of waddan
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_05 }
        allow = {
            owns = 8142
            hidden:p:8142 = {
                has_construction = no
                has_city_status = yes
                has_building = forum_building
                has_building = military_building
                has_building = commerce_building
                has_building = population_building
            }
        }

        highlight = {
            scope:province = {
                province_id = 8142
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.8 }

            show_as_tooltip = {
                add_centralization = 10

                p:8142 = {
                    add_permanent_province_modifier = {
                        name = waddan_glory
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_10 = { # The date trade
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_06 }

        allow = { 
            treasury >= 150
            #At least 3 dates are being produced in the Fezzan region
            custom_tooltip = {
                text = fezzan_dates_produced_task24_tooltip
                fezzan_dates_produced_task24_current >= fezzan_dates_produced_task24_total
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.10 }
            show_as_tooltip = {
                add_country_modifier = {
                    name = fezzani_the_perfect_date
                }
                p:8168 = {
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
                add_innovation = 2
            }
        }
    }

    fezzani_mission_01_task_11 = { # The Makae
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_04 }

        allow = {
            owns_or_subject_owns = 8142
        }

        bypass = {
            OR = {
                c:MKA = {
                    has_land = no
                }
                c:MKA = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8218
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.11 }
            
            show_as_tooltip = {
                p:8218 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_12 = { # subjects of the garamantes
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_07 }

        allow = {
            political_influence >= 200
            stability >= 60
            custom_tooltip = {
                text = fezzani_mission_01_task_12_tt
                any_subject = {
                    count >= 1
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.12 }
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_12_tt_a
                add_political_influence = -200
                add_country_modifier = {
                    name = garamantes_march
                }
                every_subject = {
                    add_country_modifier = {
                        name = subject_military_contribution
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_13 = { # the phazania
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_07 }

        allow = {
            p:8154 = {
                has_city_status = yes
                has_building = fortress_building
                num_of_military_building >= 3
            }
            treasury >= 50
        }

        bypass = {
            OR = {
                c:PHZ = {
                    has_land = no
                }
                c:PHZ = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8233
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.13 }
            # event chain
            
            show_as_tooltip = {
                add_treasury = -50
                p:8233 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_14 = { # psyllia
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_08 fezzani_mission_01_task_11 }

        allow = {
            OR = {
                owns_or_subject_owns = 8137
                owns_or_subject_owns = 8197
            }
        }

        bypass = {
            OR = {
                c:PSY = {
                    has_land = no
                }
                c:PSY = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 3333
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.14 }
            # event chain
            
            show_as_tooltip = {

                custom_tooltip = me_fezzani_14.a.tt
        
                add_treasury = -50
            }
        }
    }

    fezzani_mission_01_task_15 = { # an eastern capital prep to colonize
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_09 }

        allow = {
            owns = 8128
            hidden:p:8128 = {
                num_of_used_building_slots >= 7
                num_of_fortress_building >= 2
                has_building = forum_building
                has_building = library_building
                has_building = population_building
            }
        }

        highlight = {
            scope:province = {
                province_id = 8128
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.15 }
            
            show_as_tooltip = {
                add_innovation = 4
                p:8128 = {
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
            }
        }
    }

    fezzani_mission_01_task_16 = { # the mines of Phazania
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_13 }

        allow = {
            owns = 8238
            hidden:p:8238 = {
                has_building = slave_mine_building
            }
            owns = 8229
            hidden:p:8229 = {
                has_building = slave_mine_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8238
                    province_id = 8229
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.16 }
            # event chain possibly to move the capital to the old nasamonian capitsl
            
            show_as_tooltip = {
                p:8238 = {
                    add_permanent_province_modifier = {
                        name = mines_phazania
                    }
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
                p:8229 = {
                    add_permanent_province_modifier = {
                        name = mines_phazania
                    }
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
            }
        }
    }

    fezzani_mission_01_task_17 = { # the land of the makae
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_11 }

        allow = {
            owns = 8220
            hidden:p:8220 = {
                has_building = slave_mine_building
            }
            owns = 8222
            hidden:p:8222 = {
                has_building = slave_mine_building
            }
            owns = 8217
            hidden:p:8217 = {
                has_building = slave_mine_building
            }
            owns = 8226
            hidden:p:8226 = {
                has_building = basic_settlement_infratructure_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8220
                    province_id = 8222
                    province_id = 8217
                    province_id = 8226
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.17 }
            # check if BASE has_owner , if not colonize it for money
            
            show_as_tooltip = {
                add_4_free_province_investments = yes
                p:8218 = {
                    add_permanent_province_modifier = {
                        name = makaean_infrastructure
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_18 = { # the ports of Psyllia
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_10 }

        allow = {
            owns = 3333
            hidden:p:3333 = {
                has_city_status = yes
                has_construction = no
                num_of_port_building >= 4
            }
            custom_tooltip = {
                text = fezzani_mission_01_task_18_tt
                any_navy = {
                    any_sub_unit = {
                        count >= 15
                    }
                    has_commander = yes
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3333
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.18 }
            # check if BASE has_owner , if not colonize it for money
            
            show_as_tooltip = {
                add_country_modifier = {
                    name = ports_of_psyllia
                }
            }
        }
    }

    fezzani_mission_01_task_19 = { # colonized by nasamonia
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_08 }

        allow = {
            owns = 8134
            hidden:p:8134 = {
                free_building_slots = 0
            }
            owns = 8130
            hidden:p:8130 = {
                free_building_slots = 0
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8134
                    province_id = 8130
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.19 }
            # event chain about meeting the greek ownwers of 3340
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_19_tt
            }
        }
    }

    fezzani_mission_01_task_20 = { # a desert Rose
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_14 fezzani_mission_01_task_19 }

        final = yes

        allow = {
            owns_region = fezzan_region
        }

        highlight = {
            scope:province = {
                is_in_region = fezzan_region
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.20 }
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_20_tt
            }
        }
    }






} # last