etruria_roman_incursion = {
	header = "mission_image_rome"
	icon = "rome_2"

	repeatable = no

	chance = {
		factor = 50000
	}

	potential = {
		tag = ETR
		#NOT = { has_variable = etrurian_mission_one_cooldown }
	}

	abort = {

	}

	on_start = {
		start_mission_ai_effect = yes
		save_scope_as = etruria_scope
		trigger_event = {
			id = me_etruria.1
		}
	}

	on_abort = {
		custom_tooltip = general_mission_cooldown_tt
		set_variable = {
		    name = etrurian_mission_one_cooldown
		    days = 7300
		}
		hidden_effect = {
			if = {
				limit = {
					has_country_modifier = etruria_roman_incursion_modifier
				}
				remove_country_modifier = etruria_roman_incursion_modifier
			}
		}
	}

	on_completion = {
		hidden_effect = {
			if = {
				limit = {
					has_country_modifier = etruria_roman_incursion_modifier
				}
				remove_country_modifier = etruria_roman_incursion_modifier
			}
		}
		complete_mission_effect = yes
	}

	etruria_roman_incursion_task_1 = { # Pesky Neighbours
		icon = "task_political"
		duration = 365
		
		allow = {
			political_influence >= 30
		}

		on_start = {
			trigger_event = {
				id = me_etruria.2
				days = 100
			}
			trigger_event = {
				id = me_etruria.3
				days = 200
			}
			trigger_event = {
				id = me_etruria.4
				days = 300
			}
		}

		on_completion = {
			add_political_influence = -30
			custom_tooltip = etruria_roman_incursion_task_1_c_tt
		}
	}

	etruria_roman_incursion_task_2 = { # Roma Delenda Est
		icon = "task_political"
		duration = 120
		requires = { etruria_roman_incursion_task_1 }
		prevented_by = { etruria_roman_incursion_task_11 }

		allow = {
			political_influence >= 10
		}

		bypass = { has_completed_mission_task = etruria_roman_incursion_task_11 }

		on_start = {
			trigger_event = {
				id = me_etruria.6
				days = 60
			}
		}

		on_completion = {
			add_political_influence = -10
			custom_tooltip = etruria_roman_incursion_task_2_c_tt
			hidden_effect = {
				area:roma_area = {
					every_area_province = {
						add_claim = root
					}
				}
			}
		}
	}

	etruria_roman_incursion_task_3 = { # Reform the Military
		icon = "task_political"
		requires = { etruria_roman_incursion_task_2 }
		prevented_by = { etruria_roman_incursion_task_11 }

		allow = {
			manpower >= 7
			custom_tooltip = {
	        	text = etruria_roman_incursion_task_3_effect_tt
                any_character = {
                    has_office = office_tribune_of_the_soldiers
                    loyalty >= etruria_roman_incursion_task_3_target_svalue
                    martial >= etruria_roman_incursion_task_3_martial_target_svalue
                }
            }
		}

		on_completion = {
			add_treasury = -100
			add_manpower = -7
			add_stability = 10
			hidden_effect = {
				random_character = {
					limit = {
						has_office = office_tribune_of_the_soldiers
					}
                    save_scope_as = soldier_tribune_scope
                }
			}
			scope:soldier_tribune_scope = {
				add_gold = 100
				add_prominence = 100
				add_loyalty = etruria_reform_the_military_loyalty
			}
			add_country_modifier = {
				name = etruria_siegecraft_experiments_modifier
				duration = -1
			}
		}
	}

	etruria_roman_incursion_task_4 = { # Secret Invasions
		icon = "task_political"
		duration = 100
		requires = { etruria_roman_incursion_task_3 }

		allow = {
			political_influence >= 30
			stability >= 65
			current_ruler = { popularity >= 70 }
		}

		on_start = {
			trigger_event = {
				id = me_etruria.8
				days = 30
			}
			add_treasury = -200
			add_political_influence = -30
			add_manpower = -6
			current_ruler = { add_gold = -150 }

		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_4.c.tt
		}
	}

	etruria_roman_incursion_task_5 = { # Return of the Senones
		icon = "task_political"
		duration = 120
		requires = { etruria_roman_incursion_task_2 etruria_roman_incursion_task_11 }

		allow = {

		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_5.c.tt
			add_treasury = -20
			c:UMB = { add_treasury = 20 }
			add_military_access = c:UMB
		}
	}

	etruria_roman_incursion_task_6 = { # Celtic Ways
		icon = "task_political"
		duration = 35
		requires = { etruria_roman_incursion_task_5 }

		allow = {
			political_influence >= 5
			custom_tooltip = {
				text = etruria_roman_incursion_task_6.a.tt
				has_variable = senones_accepted
			}
		}

		on_start = {
			hidden_effect = {
				p:131 = {
					define_pop = {
						type = tribesmen
						culture = sennonian
						religion = druidism
					}
					define_pop = {
						type = tribesmen
						culture = sennonian
						religion = druidism
					}
					define_pop = {
						type = tribesmen
						culture = sennonian
						religion = druidism
					}
					define_pop = {
						type = tribesmen
						culture = sennonian
						religion = druidism
					}
					define_pop = {
						type = tribesmen
						culture = sennonian
						religion = druidism
					}
					define_pop = {
						type = freemen
						culture = sennonian
						religion = druidism
					}
					define_pop = {
						type = freemen
						culture = sennonian
						religion = druidism
					}
					define_pop = {
						type = freemen
						culture = sennonian
						religion = druidism
					}
					define_pop = {
						type = citizen
						culture = sennonian
						religion = druidism
					}
				}
			}
		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_6.c.tt
			custom_tooltip = etruria_roman_incursion_task_6.c.tt3
			custom_tooltip = etruria_roman_incursion_task_6.c.tt2
			approval_effect = {
				PARTY = traditionalist_party
				VALUE = party_disapproval_large_svalue
			}
			current_ruler = {
				add_popularity = -10
			}
			p:131 = {
				add_permanent_province_modifier = { name = etruria_northern_crossroads_modifier }
			}
			trigger_event = {
				id = me_etruria.14
				days = 35
			}
			if = {
				limit = {
					has_variable = senones_accepted
				}
				remove_variable = senones_accepted
			}
		}
	}

	etruria_roman_incursion_task_7 = { # The Carthaginian Card
		icon = "task_political"
		duration = 120
		requires = { etruria_roman_incursion_task_2 etruria_roman_incursion_task_11 }

		allow = {

		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_7.c.tt
		}
	}

	etruria_roman_incursion_task_8 = { # Carthaginian Ways
		icon = "task_political"
		duration = 35
		requires = { etruria_roman_incursion_task_7 }

		allow = {
			political_influence >= 10
			custom_tooltip = {
				text = etruria_roman_incursion_task_8.a.tt
				has_variable = carthage_accepted
			}
		}

		on_start = {
			hidden_effect = {
				p:3515 = {
					define_pop = {
						type = nobles
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = citizen
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = citizen
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = freemen
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = freemen
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = freemen
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = freemen
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = freemen
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = slaves
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = slaves
						culture = carthaginian
						religion = carthaginian_pantheon
					}
					define_pop = {
						type = slaves
						culture = carthaginian
						religion = carthaginian_pantheon
					}
				}
			}
		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_8.c.tt
			custom_tooltip = etruria_roman_incursion_task_8.c.tt3
			custom_tooltip = etruria_roman_incursion_task_8.c.tt2
			approval_effect = {
				PARTY = traditionalist_party
				VALUE = party_disapproval_large_svalue
			}
			add_political_influence = -10
			current_ruler = {
				add_popularity = -14
			}
			p:3515 = {
				add_permanent_province_modifier = { name = etruria_popular_satellite_modifier }
			}
			trigger_event = {
				id = me_etruria.15
				days = 35
			}
			if = {
				limit = {
					has_variable = carthage_accepted
				}
				remove_variable = carthage_accepted
			}
		}
	}

	etruria_roman_incursion_task_9 = { # Epirote Ambitions
		icon = "task_political"
		duration = 120
		requires = { etruria_roman_incursion_task_2 etruria_roman_incursion_task_11 }

		allow = {
			
		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_9.c.tt
		}
	}

	etruria_roman_incursion_task_10 = { # Greek Ways
		icon = "task_political"
		duration = 35
		requires = { etruria_roman_incursion_task_9 }

		allow = {
			political_influence >= 15
			custom_tooltip = {
				text = etruria_roman_incursion_task_10.a.tt
				has_variable = epirus_accepted
			}
		}

		on_start = {
			hidden_effect = {
				p:14 = {
					define_pop = {
						type = nobles
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = nobles
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = citizen
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = citizen
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = citizen
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = freemen
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = freemen
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = freemen
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = slaves
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = slaves
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = slaves
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = slaves
						culture = epirote
						religion = roman_pantheon
					}
					define_pop = {
						type = slaves
						culture = epirote
						religion = roman_pantheon
					}
				}
			}
		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_10.c.tt
			custom_tooltip = etruria_roman_incursion_task_10.c.tt3
			custom_tooltip = etruria_roman_incursion_task_10.c.tt2
			approval_effect = {
				PARTY = traditionalist_party
				VALUE = party_disapproval_large_svalue
			}
			add_political_influence = -15
			current_ruler = {
				add_popularity = -14
			}
			p:14 = {
				add_permanent_province_modifier = {
					name = etruria_greek_hub_modifier
				}
			}
			trigger_event = {
				id = me_etruria.16
			}
			if = {
				limit = {
					has_variable = epirus_accepted
				}
				remove_variable = epirus_accepted
			}
		}
	}

	etruria_roman_incursion_task_11 = { # Roma Debet Esse Nostra
		icon = "task_political"
		duration = 120
		requires = { etruria_roman_incursion_task_1 }
		prevented_by = { etruria_roman_incursion_task_2 }

		allow = {
			political_influence >= 10
		}

		bypass = { has_completed_mission_task = etruria_roman_incursion_task_2 }

		on_start = {
			trigger_event = {
				id = me_etruria.17
				days = 60
			}
		}

		on_completion = {
			add_political_influence = -10
			add_stability = 10
		}
	}

	etruria_roman_incursion_task_12 = { # Woo the Roman Vassals
		icon = "task_political"
		duration = 120
		requires = { etruria_roman_incursion_task_11 }

		allow = {

		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_12.c.tt
		}
	}

	etruria_roman_incursion_task_13 = { # Campanian Insurgency
		icon = "task_political"
		duration = 120
		requires = { etruria_roman_incursion_task_2 etruria_roman_incursion_task_11 }
		prevented_by = { etruria_roman_incursion_task_14 }

		allow = {
			custom_tooltip = {
				text = etruria_roman_incursion_one_of_three.a.tt
				OR = {
					has_completed_mission_task = etruria_roman_incursion_task_5
					has_completed_mission_task = etruria_roman_incursion_task_7
					has_completed_mission_task = etruria_roman_incursion_task_9
				}
			}

			political_influence = 20
			treasury = 200
		}

		on_start = {
			trigger_event = {
				id = me_etruria.18
				days = 20
			}
		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_13.c.tt
		}
	}

	etruria_roman_incursion_task_14 = { # The End of Roman Domination
		icon = "task_political"
		duration = 60
		requires = { etruria_roman_incursion_task_2 etruria_roman_incursion_task_11 }

		allow = {
			custom_tooltip = {
				text = etruria_roman_incursion_one_of_three.a.tt
				OR = {
					has_completed_mission_task = etruria_roman_incursion_task_5
					has_completed_mission_task = etruria_roman_incursion_task_7
					has_completed_mission_task = etruria_roman_incursion_task_9
				}
			}
		}

		on_start = {
			trigger_event = {
				id = me_etruria.23
				days = 20
			}
		}

		on_completion = {
			custom_tooltip = etruria_roman_incursion_task_14.c.tt
		}
	}

	etruria_roman_incursion_task_15 = { # The Fate of Rome
		icon = "task_political"
		requires = { etruria_roman_incursion_task_14 }

		allow = {

		}

		on_completion = {
			
		}
	}

	etruria_roman_incursion_task_16 = { # Stealing Epirote Gains
		icon = "task_political"
		requires = { etruria_roman_incursion_task_9 etruria_roman_incursion_task_15 }

		allow = {

		}

		on_completion = {
			
		}
	}

	etruria_roman_incursion_task_17 = { # A More Peaceful Italia
		icon = "task_political"
		requires = { etruria_roman_incursion_task_15 }
		final = yes

		allow = {

		}

		on_completion = {
			
		}
	}
}