rhodes_01_aegean = {
    icon = "thrace_3"
    header = "mission_image_greek"

    repeatable = yes

    chance = {
    	factor = 5000
    }

    potential = {
        tag = RHO
#        NOT = { has_variable = rhodes_missions_cooldown }
    }

    on_start = {
        start_mission_ai_effect = yes
        save_scope_as = mission_country
    }

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = rhodes_missions_cooldown
            days = 7300
        }
    }

    on_completion = {
        complete_mission_effect = yes
    }

    rhodes_01_aegean_task_1 = { #Siegeworks
        icon = "task_conquest"

        allow = {

        }

        on_completion = {
            #Choose what to do with the siegeworks of Demetrius
            custom_tooltip = rhodes_01_aegean_task_1_tooltip
        }

    }

    rhodes_01_aegean_task_2 = { #Rebuilding the Island
        icon = "task_conquest"
        duration = 180

        on_start = {

        }

        allow = {
            treasury >= 50
        }

        on_completion = {
            #Trigger event to restore Rhodes
            custom_tooltip = rhodes_01_aegean_task_2_tooltip
            add_treasury = -50
        }

    }

    rhodes_01_aegean_task_3 = { #Restoring Rhodes
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_2 }

        allow = {
            #Rhodes has no free building slots
            custom_tooltip = {
            text = rhodes_01_aegean_task_3_tooltip
                p:266 = {
                    free_building_slots = 0
                    has_construction = no
                }
            }
        }

        on_completion = {
            p:266 = {
                add_permanent_province_modifier = {
                    name = city_of_rhodes
                    mode = add
                }
            }
        }
    }

    rhodes_01_aegean_task_4 = { #A City Reborn
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_3 }

        allow = {
            custom_tooltip = {
                text = rhodes_01_aegean_task_4_tooltip
                p:266 = {
                    num_of_used_building_slots >= 10
                    has_construction = no
                    any_pops_in_province = {
                        pop_type = citizen
                        count >= 15
                    }
                    any_pops_in_province = {
                        pop_type = freemen
                        count >= 15
                    }
                    any_pops_in_province = {
                        pop_type = nobles
                        count >= 5
                    }                
                }
            }
        }

        on_completion = {
            p:266 = {
                add_permanent_province_modifier = {
                    name = city_of_rhodes
                    mode = add
                }
            }       
        }
    }

    rhodes_01_aegean_task_6 = { #Cretan Conquest
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_1 }

        allow = {
            custom_tooltip = {
                text = rhodes_01_aegean_task_6_tooltip
                any_owned_province = {
                    is_in_area = crete_area
                }
            }
        }

        on_completion = {
            area:crete_area = {
                every_area_province = {
                    limit = {
                        NOT = { owner = root }
                    }
                    add_claim = ROOT 
                }
            }
        }

    }

    rhodes_01_aegean_task_7 = { #Food Stores
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_2 }

        allow = {
            #Both provinces have farming settlements and at least 5 slaves
            custom_tooltip = {
                text = rhodes_01_aegean_task_7_A_tooltip
                p:8015 = {
                    owner = root
                    num_of_basic_settlement_infratructure_building = 1
                    has_construction = no
                    any_pops_in_province = {
                        pop_type = slaves
                        count >= 5
                    }
                }
            }
            custom_tooltip = {
                text = rhodes_01_aegean_task_7_B_tooltip
                p:280 = {
                    owner = root
                    num_of_basic_settlement_infratructure_building = 1
                    has_construction = no
                    any_pops_in_province = {
                        pop_type = slaves
                        count >= 5
                    }                
                }
            }
        }

        on_completion = {
            p:8015 = {
                add_province_modifier = {
                    name = fruitful_fishing
                    duration = -1
                }
            }
            p:280 = {
                add_province_modifier = {
                    name = fruitful_fishing
                    duration = -1
                }
            }
        }
    }

    rhodes_01_aegean_task_8 = { #The Ships of Rhodes
        icon = "task_conquest"

        allow = {
            #Rhodes has at least 15 light ships
            custom_tooltip = {
                text = rhodes_01_aegean_task_8_A_tooltip
                any_navy = {
                    any_sub_unit = {
                        count >= 10
                        OR = {
                            sub_unit_type = trireme
                            sub_unit_type = liburnian
                        }
                    }
                }
            }          
        }

        on_completion = {
            add_country_modifier = {
                name = preparing_a_fleet
                duration = 1095
            }
        }

    }

    rhodes_01_aegean_task_9 = { #The Sporades
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_1 }

        allow = {
            political_influence >= 25
        }

        on_completion = {
            #Advocate for the Independence of Kos and Knidos
            #If they are Independent then ask them to become feudatories.
            custom_tooltip = rhodes_01_aegean_task_9_A_tooltip
        }

    }

    rhodes_01_aegean_task_10 = { #Masters of Crete
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_6 }

        highlight = {
            scope:province = {
                is_in_area = crete_area
            }
        }

        allow = {
            owns_or_subject_owns_area = crete_area
        }

        on_completion = {
        #Gain modifier
            add_treasury = 250
            add_military_experience = 30
            add_country_modifier = {
                name = masters_of_crete
                duration = 3650
            }
        }
    }

    rhodes_01_aegean_task_11 = { #A Cretan Metropolis
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_6 }

        allow = {
            #Any province in the crete area is a metropolis with at least 60 pops and at least
            custom_tooltip = {
                text = rhodes_01_aegean_task_11_A_tooltip
                any_owned_province = {
                    is_in_area = crete_area
                    has_province_rank = city_metropolis
                    total_population >= 60
                }
            }
        }

        on_completion = {
        #Gain a province modifer, convert a few pops culture.
            add_political_influence = 25
            ordered_owned_province = {
                limit = {
                    is_in_area = crete_area
                    has_province_rank = city_metropolis  
                    owner = root                      
                }
                order_by = total_population
                max = 1
                define_pop = {
                    type = nobles
                    culture = root.culture
                    religion = root.religion
                }
                while = {
                    count = 3 
                    define_pop = {
                        type = citizen
                        culture = root.culture
                        religion = root.religion
                    }
                }
                ordered_pops_in_province = {
                    limit = {
                        NOT = { pop_culture = root.culture }
                    }
                    order_by = pop_hapiness
                    max = 5
                    set_pop_culture = root.culture
                }
            }
        }

    }
    rhodes_01_aegean_task_12 = { #Developing Crete
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_6 }

        allow = {
            #At least 5 provinces in the crete area fulfill the following conditions:
            #has city status
            #at least 20 pops
            #has at least 5 buildings 
            #have no ongoing construction
            p:359.state = {
                incoming_trade_routes >= 5
            }
            custom_tooltip = {
                text = rhodes_01_aegean_task_12_A_tooltip
                any_owned_province = {
                    count >= 5
                    is_in_area = crete_area
                    OR = {
                        has_province_rank = city_metropolis
                        has_province_rank = city
                    }
                    total_population >= 20
                    num_of_used_building_slots >= 5
                    has_construction = no
                }
            }
        }

        on_completion = {
        #Give a permanant state modifier to the island of Crete
            p:359 = {
                add_state_loyalty = 20
            }
            if = {
                limit = {
                    any_owned_province = { is_in_area = crete_area }
                }
                random_owned_province = {
                    limit = { is_in_area = crete_area }
                    state = {
                        add_state_modifier = {
                            name = united_crete
                            duration = -1
                        }
                    }
                }
            }
        }

    }    

    rhodes_01_aegean_task_13 = { #Consolidate our Homeland
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_9 }

        allow = {
            owns_or_subject_owns_area = sporades_area
        }

        on_completion = {
            #Add some stuff and claims on the aegean island area
            add_treasury = 300
            add_stability = 5
            current_ruler = {
                add_popularity = 10
            }
        }

    }
    rhodes_01_aegean_task_14 = { #The Aegean Islands
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_9 }

        allow = {
            owns_or_subject_owns_area = aegean_islands_area
        }

        on_completion = {
            #Add some stuff
            p:263 = {
                add_state_loyalty = 20
            }
            if = {
                limit = {
                    any_owned_province = { is_in_area = aegean_islands_area }
                }
                random_owned_province = {
                    limit = { is_in_area = aegean_islands_area }
                    state = {
                        add_state_modifier = {
                            name = aegean_trade
                            duration = -1
                        }
                    }
                }
            }            
        }

    }

    rhodes_01_aegean_task_15 = { #An Aegean Power
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_10 rhodes_01_aegean_task_13 rhodes_01_aegean_task_14 }
        final = yes

        allow = {
            owns_or_subject_owns_area = aegean_islands_area
            owns_or_subject_owns_area = sporades_area
            owns_or_subject_owns_area = crete_area
        }

        on_completion = {
            #Add some stuff
            add_country_modifier = {
                name = aegean_power
                duration = -1
            }
        }

    }

    rhodes_01_aegean_task_16 = { #Matter of Lindos
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_2 }

        allow = {
            #Lindos is a city
            custom_tooltip = {
                text = rhodes_01_aegean_task_16_tooltip
                p:1830 = {
                    has_city_status = yes
                    has_construction = no
                    num_of_used_building_slots >= 5
                    total_population >= 15
                    num_of_citizen >= 5
                    any_pops_in_province = {
                        percent <= 0.33
                        pop_type = slaves
                    }
                }
            }
        }

        on_completion = {
            
        }

    }

    rhodes_01_aegean_task_17 = { #A Merchant Fleet
        icon = "task_conquest"
        requires = { rhodes_01_aegean_task_8 }

        allow = {
            capital_scope.state = {
                trade_good_surplus = { target = wood value >= 2 }
            }
            custom_tooltip = {
                text = rhodes_01_aegean_task_17_A_tooltip
                any_navy = {
                    any_sub_unit = {
                        count >= 30
                        OR = {
                            sub_unit_type = trireme
                            sub_unit_type = liburnian
                        }
                    }
                    has_commander = yes
                    commander = {
                        martial >= 9
                    }
                }
            }
        }

        on_completion = {
            add_country_modifier = {
                name = rhodian_merchant_navy
                duration = -1
            }
            #Add some stuff
#            random_navy = {
#                limit = {
#                    any_sub_unit = {
#                        count >= 30
#                        OR = {
#                            sub_unit_type = trireme
#                            sub_unit_type = liburnian
#                        }
#                    }
#                    has_commander = yes
#                }
#                save_scope_as = aegean_merchant_navy
#                commander = { save_scope_as = aegean_naval_admiral }
#           }
        }

    }

}