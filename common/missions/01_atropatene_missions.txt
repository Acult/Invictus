atropatene_mission_01 = {
    header = "mission_image_general" # SPECIAL FIELD - Sets top picture for the mission
    icon = "general_3" # SPECIAL FIELD - Sets icon for the mission

    repeatable = no # SPECIAL FIELD - Sets if a mission can be done once or several times

    chance = {
        factor = 50000
    } # SPECIAL FIELD - Sets the chances of a mission appearing in your list of available missions

    potential = {
        NOT = { has_variable = atropatene_mission_cooldown }
        tag = MAP # TRIGGER FIELD - Sets the conditions for the mission to appear in your list
        is_subject = no # must not be a subject
    }
    on_start = {
        save_scope_as = me_atropatene_scope
        start_mission_ai_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is started

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = atropatene_mission_cooldown
            days = 1 #7300
        }
    } # EFFECT FIELD - These effects are run when the mission is aborted

    on_completion = {
        complete_mission_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is completed


    atropatene_mission_01_task_01 = { # A State for the Medes
        icon = "task_political"

        allow = {
            # TODO figure this one out

            #has_country_culture_modifier = trial_right
            #has_country_culture_modifier = land_protection
            #has_country_culture_modifier = citizenship_by_adoption
        }

        on_completion = {
            trigger_event = { id = me_atropatene.1 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = state_for_the_medes
                    duration = 3650
                }
            }
        }
    }

    atropatene_mission_01_task_02 = { # The Birthplace of Zoroaster
        icon = "task_political"

        allow = {
            political_influence >= 50
        }

        highlight = {
            scope:province = {
                province_id = 1627
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.2 }

            show_as_tooltip = {
                add_political_influence = -50
                add_treasury = -200
                p:1627 = {
                    set_city_status = city
                }
            }
        }

    }

    atropatene_mission_01_task_03 = { # Strenthen the Median Identity
        icon = "task_political"
        requires = { atropatene_mission_01_task_01 }

        allow = {
            area:media_area = {
                dominant_province_culture = cadusian
            }
            area:media_atropatene_area = {
                dominant_province_culture = cadusian
            }
            area:parsatunik_area = {
                dominant_province_culture = cadusian
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = media_area
                    is_in_area = media_atropatene_area
                    is_in_area = parsatunik_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.3 }
            show_as_tooltip = {
                add_country_modifier = {
                    name = the_median_identity
                    duration = 3650
                }
            }
        }

    }

    atropatene_mission_01_task_04 = { # Prosperity of Glittering Salt
        icon = "task_political"
        requires = { atropatene_mission_01_task_01 }

        highlight = {
			scope:province = {
                OR = {
                    province_id = 1648
                    province_id = 1630
                    province_id = 4985
                    province_id = 4986
                }
			}
        }

        allow = {
            hidden:p:1648 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:1630 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:4985 = {
                has_construction = no
				has_building = population_building # Granary
            }
            hidden:p:4986 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.4 }

            show_as_tooltip = {
                p:1648 = {
                    add_province_modifier = {
                        name = prosperity_glittering_salt
                        duration = 3650
                    }
                }
                p:1630 = {
                    add_province_modifier = {
                        name = prosperity_glittering_salt
                        duration = 3650
                    }
                }
                p:4985 = {
                    add_province_modifier = {
                        name = prosperity_glittering_salt
                        duration = 3650
                    }
                }
                p:4986 = {
                    add_province_modifier = {
                        name = prosperity_glittering_salt
                        duration = 3650
                    }
                }
            }
        }

    }

    atropatene_mission_01_task_05 = { # The Holy City of Ganzak
        icon = "task_political"
        requires = { atropatene_mission_01_task_02 }

        allow = {
            stability >= 65
            hidden:p:1515 = {
                religious_unity >= 95
                has_building = temple_building
                has_building = theathre_building
                custom_tooltip = { 
                    text = atropatene_mission_01_task_05_tt                   
                    any_pops_in_province = {
                        pop_type = citizen
                        count >= 10
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 1515
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.5 }
            show_as_tooltip = {
                add_country_modifier = {
                    name = the_holy_city
                    duration = -1
                }
            }
        }

    }

    atropatene_mission_01_task_06 = { # Mystical Kashmar
        icon = "task_political"
        requires = { atropatene_mission_01_task_02 }

        allow = {
            treasury >= 400
            manpower >= 2 # how is this 1000
            political_influence >= 30
            owns_or_subject_owns = 1571
            owns_or_subject_owns_area = parsatunik_area
            owns_or_subject_owns_area = soducene_area
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 1571 # chosen for the large population it has
                    is_in_area = parsatunik_area
                    is_in_area = soducene_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.6 }

            show_as_tooltip = {
                current_ruler = { add_popularity = popularity_medium }
                add_legitimacy = 10
            }
        }

    }

    atropatene_mission_01_task_07 = { # Reinstate the Magi
        icon = "task_political"
        requires = { atropatene_mission_01_task_02 }

        allow = {
            # TODO check omen power for 110%
			custom_tooltip = {
				text = atropatene_mission_01_task_07_tt
				trigger_if = {
					limit = {
						any_character = { has_office = office_high_priest_monarchy }
					}
					any_character = {
						has_office = office_high_priest_monarchy
						loyalty >= 70
					}
				}
			}
            invention = gw_effect_zeal_education_inv # Has the invention Theological Colleges
            invention = omen_power_inv_4 # Has the invention Proscribed Canon
            invention = omen_duration_inv_1 # Has the invention Grand Temples
        }

        on_completion = {
            trigger_event = { id = me_atropatene.7 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = reinstated_magi
                    duration = 3650
                }
                custom_tooltip = atropatene_mission_01_task_07_tt2
            }
        }

    }

    atropatene_mission_01_task_08 = { # For My Son
        icon = "task_political"
        requires = { atropatene_mission_01_task_03 }

        allow = {
            custom_tooltip = atropatene_mission_01_task_08_tt
            hidden:char:24 = { # Seleucus I Nicator
                is_alive = no 
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.8 }

            show_as_tooltip = {
                current_ruler = { 
                    add_popularity = popularity_large 
                    force_add_trait = ambitious 
                    family = {
                        add_prestige = 100
                    }
                }
                c:MAP = {
                    add_country_modifier = {
                        name = seleukid_unrest
                    }
                }
                c:SEL = {
                    add_country_modifier = {
                        name = death_of_seleucus
                    }
                }
            }
        }

    }

    atropatene_mission_01_task_09 = { # The Atropatene Treasury
        icon = "task_political"
        requires = { atropatene_mission_01_task_04 atropatene_mission_01_task_05 }

        allow = {
            p:1515 = {
                num_of_academy_building >= 2 # academy
                num_of_library_building >= 2 # library
                num_of_commerce_building >= 3 # marketplace
                num_of_town_hall_building >= 3 # Tax office

                custom_tooltip = { 
                    text = atropatene_mission_01_task_09_tt_1
                    any_pops_in_province = {
                        pop_type = noble
                        count >= 5
                    }
                }
                custom_tooltip = { 
                    text = atropatene_mission_01_task_09_tt_2
                    any_pops_in_province = {
                        count >= 45
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 1515
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.9 }

            show_as_tooltip = {
                add_4_free_province_investments = yes
                add_innovation = 4
                add_political_influence = 100

                p:1515 = {
                    add_permanent_province_modifier = {
                        name = treasury_of_ganzak
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_10 = { # Hunt for the Avesta
        icon = "task_political"
        requires = { atropatene_mission_01_task_05 }

        allow = {
            manpower >= 10
            owns_or_subject_owns_area = persepolis_area
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = persepolis_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.10 }
            # TODO event chain
        }
    }

    atropatene_mission_01_task_11 = { # Travels of the Royal Spirit
        icon = "task_political"
        requires = { atropatene_mission_01_task_06 }

        allow = {
            hidden:p:4985 = {
                has_building = temple_building
                has_building = forum_building

                custom_tooltip = { 
                    text = atropatene_mission_01_task_10_tt_1
                    any_pops_in_province = {
                        pop_type = noble
                        count >= 5
                    }
                }
                custom_tooltip = { 
                    text = atropatene_mission_01_task_10_tt_2
                    any_pops_in_province = {
                        count >= 50
                    }
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.11 }

            show_as_tooltip = {
                p:4985 = {
                    add_permanent_province_modifier = {
                        name = the_royal_spirit
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_12 = { # The Faith of the Kadousioi
        icon = "task_political"
        requires = { atropatene_mission_01_task_07 }

        allow = {
            has_law = heritage_tax_exemption
            area:kadousioi_area = {
                num_of_cities >= 6 # verify
                # TODO check each city for 3 nobles
            }
            p:1627 = {
                treasure_count >=2
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 1627
                    is_in_area = kadousioi_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.12 }

            show_as_tooltip = {
                p:1593 = {
                    add_permanent_province_modifier = {
                        name = the_faith_of_kadousioi
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_13 = { # Civilize the Cadusians
        icon = "task_political"
        requires = { atropatene_mission_01_task_08 }

        allow = {
            area:amardioi_area = {
                dominant_province_culture = cadusian
            }
            area:kadousioi_area = {
                dominant_province_culture = cadusian
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = amardioi_area
                    is_in_area = kadousioi_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.13 }

            show_as_tooltip = {
                area:hyrcania_area = {
                    add_provincial_claim_effect = yes
                }
                add_country_modifier = {
                    name = the_civilized_cadusians_global
                    duration = -1
                }
                p:4985 = {
                    add_permanent_province_modifier = {
                        name = the_civilized_cadusians
                    }
                    create_state_pop = nobles
                    create_state_pop = nobles
                    create_state_pop = nobles
                }
                p:1593 = {
                    add_permanent_province_modifier = {
                        name = the_civilized_cadusians
                    }
                    create_state_pop = nobles
                    create_state_pop = nobles
                    create_state_pop = nobles
                }
            }
        }

    }

    atropatene_mission_01_task_14 = { # Claim to Media
        icon = "task_political"
        requires = { atropatene_mission_01_task_08 }

        on_completion = {
            trigger_event = { id = me_atropatene.14 }
            show_as_tooltip = {
                region:media_region = {
                    every_region_province = { add_claim = ROOT }
                }
            }
        }
    }

    atropatene_mission_01_task_15 = { # Consolidate Lake Matiene
        icon = "task_political"
        requires = { atropatene_mission_01_task_04 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = parskahayk_area
                    is_in_area = parsatunik_area
                }
            }
        }

        on_completion = {
            add_4_free_province_investments = yes
            area:parskahayk_area = {
                add_provincial_claim_effect = yes
            }
            area:parsatunik_area = {
                add_provincial_claim_effect = yes
            }
            p:1500 = {
                add_permanent_province_modifier = {
                    name = lake_matiene
                }
            }
            p:1504 = {
                add_permanent_province_modifier = {
                    name = lake_matiene
                }
            }
        }

    }

    atropatene_mission_01_task_16 = { # The Metropolis of Media
        icon = "task_political"
        requires = { atropatene_mission_01_task_09 }

    }

    atropatene_mission_01_task_17 = { # The Obscurity of Druj
        icon = "task_political"
        requires = { atropatene_mission_01_task_11 }

    }

    atropatene_mission_01_task_18 = { # The Light of Asha
        icon = "task_political"
        requires = { atropatene_mission_01_task_11 }

    }

    atropatene_mission_01_task_19 = { # A Holy Metropolis
        icon = "task_political"
        requires = { atropatene_mission_01_task_12 }

    }

    atropatene_mission_01_task_20 = { # Trade on the Mazandaran Sea
        icon = "task_political"
        requires = { atropatene_mission_01_task_13 }

    }

    atropatene_mission_01_task_21 = { # The Land of the Medes
        icon = "task_political"
        requires = { atropatene_mission_01_task_14 }

    }

    atropatene_mission_01_task_22 = { # Salty Success
        icon = "task_political"
        requires = { atropatene_mission_01_task_14 atropatene_mission_01_task_15 }

    }

    atropatene_mission_01_task_23 = { # Penance
        icon = "task_political"
        requires = { atropatene_mission_01_task_17 }

    }

    atropatene_mission_01_task_24 = { # Unnamed
        icon = "task_political"
        requires = { atropatene_mission_01_task_18 }

    }

    atropatene_mission_01_task_25 = { # The Median Highway
        icon = "task_political"
        requires = { atropatene_mission_01_task_21 }

    }

    atropatene_mission_01_task_26 = { # The Land of Cyaxares
        icon = "task_political"
        requires = { atropatene_mission_01_task_21 }

    }

    atropatene_mission_01_task_27 = { # Redeemed Scholar
        icon = "task_political"
        requires = { atropatene_mission_01_task_23 }

    }

    atropatene_mission_01_task_28 = { # Holy Bazaars
        icon = "task_political"
        requires = { atropatene_mission_01_task_24 }

    }

    atropatene_mission_01_task_29 = { # A Median Legacy
        icon = "task_political"
        requires = { atropatene_mission_01_task_26 }

    }

    atropatene_mission_01_task_30 = { # Imperial Zoroaster
        icon = "task_political"
        requires = { atropatene_mission_01_task_24 }

    }

}